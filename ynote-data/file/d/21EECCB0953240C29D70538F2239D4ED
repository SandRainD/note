<?xml version="1.0" encoding="UTF-8" standalone="no"?><note xmlns="http://note.youdao.com" file-version="0" schema-version="1.0.3"><head/><body><para><coId>9419-1640867722786</coId><text>分布式自动刷新配置功能</text><inline-styles/><styles/></para><para><coId>2172-1640867788195</coId><text>Spring Cloud Bus 配合Spring Cloud Config使用可以实现配置的动态刷新。</text><inline-styles/><styles/></para><para><coId>6979-1640867788195</coId><text>Bus支持两种消息代理: RabbitMQ和Kafka</text><inline-styles/><styles/></para><para><coId>6077-1640867827306</coId><text/><inline-styles/><styles/></para><image><coId>7742-1640867907596</coId><source>https://note.youdao.com/yws/res/16409/D5067506804F47C29A634368F9D44790</source><text/><styles><width>392</width><height>205</height></styles></image><para><coId>9342-1640867827640</coId><text>Spring Cloud Bus是用来将分布式系统的节点与轻量级消息系统链接起来的框架，</text><inline-styles/><styles/></para><para><coId>2017-1640867879679</coId><text>它整合了Java的事件处理机制和消息中间件的功能。</text><inline-styles/><styles/></para><para><coId>3145-1640867879679</coId><text>Spring Clud Bus目前支持RabbitMQ和Kafka。</text><inline-styles/><styles/></para><para><coId>9057-1640868337991</coId><text/><inline-styles/><styles/></para><para><coId>2072-1640867879679</coId><text>什么是总线</text><inline-styles><back-color><from>0</from><to>5</to><value>#FAE220</value></back-color></inline-styles><styles/></para><para><coId>8267-1640868336541</coId><text>在微服务架构的系统中，通常会使用轻量级的消息代理来构建一个共用的消息主题，并让系统中所有微服务实例都连接上来。由于该主题中产生的消息会被所有实例监听和消费，所以称它为消息总线。在总线上的各个实例，都可以方便地广播一些需要让其他连接在该主题上的实例都知道的消息。</text><inline-styles/><styles/></para><para><coId>6255-1640867904820</coId><text>基本原理</text><inline-styles/><styles/></para><para><coId>3419-1640868350502</coId><text>ConfigClient实例都监听MQ中同一个topic(默认是springCloudBus)。当一个服务刷新数据的时候，它会把这个信息放入到Topic中，这样其它监听同一Topic的服务就能得到通知，然后去更新自身的配置。</text><inline-styles/><styles/></para><para><coId>3795-1640867914826</coId><text/><inline-styles/><styles/></para><para><coId>7333-1640867914988</coId><text/><inline-styles/><styles/></para><para><coId>7160-1640867915100</coId><text>1）利用消息总线触发一个客户端/bus/refresh,而刷新所有客户端的配置</text><inline-styles><strike><from>2</from><to>39</to><value>true</value></strike></inline-styles><styles/></para><para><coId>2327-1640919804850</coId><text>2）利用消息总线触发一个服务端ConfigServer的/bus/refresh端点，而刷新所有客户端的配置</text><inline-styles/><styles/></para><para><coId>6125-1640919804850</coId><text/><inline-styles/><styles/></para><para><coId>8438-1640867827784</coId><text/><inline-styles/><styles/></para><para><coId>4010-1640868343363</coId><text>1、新疆一个config客户端springcloud-config-bus3366</text><inline-styles><font-family><from>0</from><to>41</to><value>微软雅黑</value></font-family><font-size><from>0</from><to>41</to><value>16</value></font-size></inline-styles><styles/></para><para><coId>1556-1640928226827</coId><text>略</text><inline-styles><font-family><from>0</from><to>1</to><value>微软雅黑</value></font-family><font-size><from>0</from><to>1</to><value>16</value></font-size></inline-styles><styles/></para><para><coId>3917-1640928229038</coId><text>2、修改configserver的配置，使其可以传递消息</text><inline-styles><font-family><from>0</from><to>28</to><value>微软雅黑</value></font-family><font-size><from>0</from><to>28</to><value>16</value></font-size></inline-styles><styles/></para><table><coId>6719-1640928276734</coId><resource-list/><content>{"cells":[{"value":"&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;\n&lt;/dependency&gt;","inlineStyles":{"font-size":[{"from":0,"to":12,"value":13},{"from":13,"to":61,"value":13},{"from":62,"to":120,"value":13},{"from":121,"to":134,"value":13}],"color":[{"from":0,"to":12,"value":"#e8bf6a"},{"from":13,"to":26,"value":"#e8bf6a"},{"from":26,"to":51,"value":"#a9b7c6"},{"from":51,"to":61,"value":"#e8bf6a"},{"from":62,"to":78,"value":"#e8bf6a"},{"from":78,"to":107,"value":"#a9b7c6"},{"from":107,"to":120,"value":"#e8bf6a"},{"from":121,"to":134,"value":"#e8bf6a"}],"back-color":[{"from":0,"to":12,"value":"#2b2b2b"},{"from":13,"to":61,"value":"#2b2b2b"},{"from":62,"to":120,"value":"#2b2b2b"},{"from":121,"to":134,"value":"#2b2b2b"}]}}],"heights":[40],"widths":[620]}</content><styles/></table><para><coId>1960-1640928281123</coId><text/><inline-styles/><styles/></para><table><coId>6179-1640928281123</coId><resource-list/><content>{"cells":[{"value":"rabbitmq:\n  host: localhost\n  port: 5672\n  username: guest\n  password: guest\n\nmanagement:\n  endpoints: #暴露bus刷新配置的端点\n    web:\n      exposure:\n        include: 'bus-refresh'\n","inlineStyles":{"italic":[{"from":103,"to":116,"value":true},{"from":117,"to":121,"value":true}],"font-family":[{"from":104,"to":106,"value":"SimSun"},{"from":109,"to":116,"value":"SimSun"},{"from":117,"to":121,"value":"SimSun"}],"font-size":[{"from":0,"to":9,"value":13},{"from":10,"to":27,"value":13},{"from":28,"to":40,"value":13},{"from":41,"to":58,"value":13},{"from":59,"to":76,"value":13},{"from":78,"to":89,"value":13},{"from":90,"to":116,"value":13},{"from":117,"to":125,"value":13},{"from":126,"to":141,"value":13},{"from":142,"to":172,"value":13}],"color":[{"from":0,"to":8,"value":"#cc7832"},{"from":8,"to":9,"value":"#a9b7c6"},{"from":10,"to":12,"value":"#a9b7c6"},{"from":12,"to":16,"value":"#cc7832"},{"from":16,"to":27,"value":"#a9b7c6"},{"from":28,"to":30,"value":"#a9b7c6"},{"from":30,"to":34,"value":"#cc7832"},{"from":34,"to":40,"value":"#a9b7c6"},{"from":41,"to":43,"value":"#a9b7c6"},{"from":43,"to":51,"value":"#cc7832"},{"from":51,"to":58,"value":"#a9b7c6"},{"from":59,"to":61,"value":"#a9b7c6"},{"from":61,"to":69,"value":"#cc7832"},{"from":69,"to":76,"value":"#a9b7c6"},{"from":78,"to":88,"value":"#cc7832"},{"from":88,"to":89,"value":"#a9b7c6"},{"from":90,"to":92,"value":"#a9b7c6"},{"from":92,"to":101,"value":"#cc7832"},{"from":101,"to":103,"value":"#a9b7c6"},{"from":103,"to":116,"value":"#629755"},{"from":117,"to":121,"value":"#629755"},{"from":121,"to":124,"value":"#cc7832"},{"from":124,"to":125,"value":"#a9b7c6"},{"from":126,"to":132,"value":"#a9b7c6"},{"from":132,"to":140,"value":"#cc7832"},{"from":140,"to":141,"value":"#a9b7c6"},{"from":142,"to":150,"value":"#a9b7c6"},{"from":150,"to":157,"value":"#cc7832"},{"from":157,"to":159,"value":"#a9b7c6"},{"from":159,"to":172,"value":"#6a8759"}],"back-color":[{"from":0,"to":9,"value":"#2b2b2b"},{"from":10,"to":27,"value":"#2b2b2b"},{"from":28,"to":40,"value":"#2b2b2b"},{"from":41,"to":58,"value":"#2b2b2b"},{"from":59,"to":76,"value":"#2b2b2b"},{"from":78,"to":89,"value":"#2b2b2b"},{"from":90,"to":116,"value":"#2b2b2b"},{"from":117,"to":125,"value":"#2b2b2b"},{"from":126,"to":141,"value":"#2b2b2b"},{"from":142,"to":172,"value":"#2b2b2b"}]}}],"heights":[40],"widths":[620]}</content><styles/></table><para><coId>2173-1640928240259</coId><text>3、客户端添加消息支持</text><inline-styles><font-family><from>0</from><to>11</to><value>微软雅黑</value></font-family><font-size><from>0</from><to>11</to><value>16</value></font-size></inline-styles><styles/></para><para><coId>1752-1640928240420</coId><text/><inline-styles/><styles/></para><image><coId>9968-1640929120960</coId><source>https://note.youdao.com/yws/res/16432/8679D9602DD944AAA2FD7F2EFDC4E55B</source><text/><styles><width>620</width><height>183</height></styles></image><para><coId>5885-1640928240702</coId><text/><inline-styles/><styles/></para><attach><coId>7866-1640929229311</coId><source>https://note.youdao.com/yws/res/16565/6319FFCDB7F54A12843247202720E80A</source><resource>https://note.youdao.com/yws/res/16564/1490B7BEA3FA4DFD8A8325EB08503D4D</resource><filename>springcloud.zip</filename><filelength>110901</filelength><styles/></attach><para><coId>5031-1640928241046</coId><text/><inline-styles/><styles/></para></body></note>