<?xml version="1.0" encoding="UTF-8" standalone="no"?><note xmlns="http://note.youdao.com" file-version="0" schema-version="1.0.3"><head/><body><para><coId>0075-1635164248428</coId><text>悲观锁</text><inline-styles><bold><from>0</from><to>3</to><value>true</value></bold><font-family><from>0</from><to>3</to><value>宋体</value></font-family><font-size><from>0</from><to>3</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>5171-1635164266713</coId><text>悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。</text><inline-styles><bold><from>0</from><to>21</to><value>true</value></bold><bold><from>92</from><to>114</to><value>true</value></bold><bold><from>117</from><to>119</to><value>true</value></bold><bold><from>120</from><to>122</to><value>true</value></bold><bold><from>124</from><to>126</to><value>true</value></bold><bold><from>127</from><to>129</to><value>true</value></bold><font-family><from>0</from><to>3</to><value>微软雅黑</value></font-family><font-family><from>3</from><to>23</to><value>Tahoma</value></font-family><font-family><from>23</from><to>80</to><value>微软雅黑</value></font-family><font-family><from>80</from><to>85</to><value>Times New Roman</value></font-family><font-family><from>85</from><to>143</to><value>微软雅黑</value></font-family><color><from>0</from><to>21</to><value>#ff0000</value></color><color><from>92</from><to>114</to><value>#c00000</value></color><color><from>117</from><to>119</to><value>#ff0000</value></color><color><from>120</from><to>122</to><value>#ff0000</value></color><color><from>124</from><to>126</to><value>#ff0000</value></color><color><from>127</from><to>129</to><value>#ff0000</value></color><color><from>141</from><to>143</to><value>#007c6a</value></color></inline-styles><styles><align>justify</align></styles></para><image><coId>3672-1635164275811</coId><source>https://note.youdao.com/yws/res/14200/2EDCFE8BD60143B485187D6AC4251113</source><text/><styles><width>620</width><height>171</height></styles></image><para><coId>4545-1635164275810</coId><text/><inline-styles/><styles><align>justify</align></styles></para><para><coId>7096-1635164277228</coId><text>乐观锁</text><inline-styles><bold><from>0</from><to>3</to><value>true</value></bold><font-family><from>0</from><to>3</to><value>宋体</value></font-family><font-size><from>0</from><to>3</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>8753-1635164287747</coId><text>乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis就是利用这种check-and-set机制实现事务的。</text><inline-styles><bold><from>0</from><to>22</to><value>true</value></bold><bold><from>100</from><to>123</to><value>true</value></bold><font-family><from>0</from><to>3</to><value>微软雅黑</value></font-family><font-family><from>3</from><to>22</to><value>Tahoma</value></font-family><font-family><from>22</from><to>124</to><value>微软雅黑</value></font-family><font-family><from>124</from><to>129</to><value>Tahoma</value></font-family><font-family><from>129</from><to>135</to><value>微软雅黑</value></font-family><font-family><from>135</from><to>148</to><value>Times New Roman</value></font-family><font-family><from>148</from><to>156</to><value>微软雅黑</value></font-family><color><from>0</from><to>20</to><value>#ff0000</value></color><color><from>100</from><to>123</to><value>#c00000</value></color><color><from>124</from><to>156</to><value>#c00000</value></color></inline-styles><styles><align>justify</align></styles></para><image><coId>1818-1635164295645</coId><source>https://note.youdao.com/yws/res/14205/63369AED55C04830ADC1D5780F8DDCE8</source><text/><styles><width>620</width><height>197</height></styles></image><para><coId>2340-1635164295645</coId><text/><inline-styles/><styles><align>justify</align></styles></para><para><coId>1014-1635164297264</coId><text>WATCH key [key ...]</text><inline-styles><bold><from>0</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>19</to><value>宋体</value></font-family><font-size><from>0</from><to>6</to><value>21</value></font-size><font-size><from>6</from><to>10</to><value>20</value></font-size><font-size><from>10</from><to>19</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>1114-1635164549499</coId><text>在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</text><inline-styles><bold><from>54</from><to>88</to><value>true</value></bold><font-family><from>0</from><to>3</to><value>微软雅黑</value></font-family><font-family><from>3</from><to>8</to><value>宋体</value></font-family><font-family><from>8</from><to>14</to><value>微软雅黑</value></font-family><font-family><from>14</from><to>32</to><value>Times New Roman</value></font-family><font-family><from>32</from><to>38</to><value>微软雅黑</value></font-family><font-family><from>38</from><to>39</to><value>Times New Roman</value></font-family><font-family><from>39</from><to>42</to><value>微软雅黑</value></font-family><font-family><from>42</from><to>48</to><value>Times New Roman</value></font-family><font-family><from>48</from><to>60</to><value>微软雅黑</value></font-family><font-family><from>60</from><to>61</to><value>Tahoma</value></font-family><font-family><from>61</from><to>64</to><value>微软雅黑</value></font-family><font-family><from>64</from><to>70</to><value>Tahoma</value></font-family><font-family><from>70</from><to>88</to><value>微软雅黑</value></font-family><font-size><from>3</from><to>8</to><value>13</value></font-size><color><from>54</from><to>88</to><value>#007c6a</value></color></inline-styles><styles/></para><image><coId>5635-1635164549499</coId><source>https://note.youdao.com/yws/res/14207/3CD8603395E149E58765350CF188D207</source><text/><styles><width>314</width><height>180</height></styles></image><para><coId>4042-1635164549499</coId><text> </text><inline-styles/><styles/></para><para><coId>5698-1635243210041</coId><text>Redis事务三特性</text><inline-styles><bold><from>0</from><to>10</to><value>true</value></bold><font-family><from>0</from><to>5</to><value>Arial</value></font-family><font-family><from>5</from><to>10</to><value>黑体</value></font-family><font-size><from>0</from><to>10</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>5910-1635243210365</coId><text>Ø 单独的隔离操作</text><inline-styles><font-family><from>2</from><to>9</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>8699-1635243210365</coId><text>n 事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</text><inline-styles><font-family><from>2</from><to>53</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>3191-1635243210365</coId><text>Ø 没有隔离级别的概念</text><inline-styles><font-family><from>2</from><to>11</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>3615-1635243210365</coId><text>n 队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</text><inline-styles><font-family><from>2</from><to>42</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>1051-1635243210365</coId><text>Ø 不保证原子性</text><inline-styles><font-family><from>2</from><to>8</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>1089-1635243210365</coId><text>n 事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚</text><inline-styles><font-family><from>2</from><to>33</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>8849-1635243210365</coId><text> </text><inline-styles><font-family><from>0</from><to>1</to><value>Tahoma</value></font-family></inline-styles><styles/></para><para><coId>9187-1635164297387</coId><text>继续增加并发测试</text><inline-styles><bold><from>0</from><to>8</to><value>true</value></bold><font-family><from>0</from><to>8</to><value>黑体</value></font-family><font-size><from>0</from><to>8</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>2870-1635252126985</coId><text>yum install httpd-tools</text><inline-styles><font-size><from>0</from><to>23</to><value>16</value></font-size></inline-styles><styles/></para><para><coId>1563-1635252126985</coId><text>ab -n 2000 -c 200 -k -p postfile -T 'application/x-www-form-urlencoded' http://192.168.140.1:8080/seckill/doseckill</text><inline-styles><underline><from>72</from><to>115</to><value>true</value></underline><font-family><from>0</from><to>6</to><value>Tahoma</value></font-family><font-family><from>6</from><to>7</to><value>Times New Roman</value></font-family><font-family><from>7</from><to>14</to><value>Tahoma</value></font-family><font-family><from>14</from><to>15</to><value>Times New Roman</value></font-family><font-family><from>15</from><to>115</to><value>Tahoma</value></font-family><color><from>72</from><to>115</to><value>#0000ff</value></color><href><from>72</from><to>115</to><value>http://192.168.140.1:8080/seckill/doseckill</value></href></inline-styles><styles/></para><image><coId>8272-1635252126985</coId><source>https://note.youdao.com/yws/res/14219/A76E18EF11D14F33B38414C207C8ACE6</source><text/><styles><align>justify</align><width>556</width><height>75</height></styles></image><para><coId>2029-1635252126985</coId><text> </text><inline-styles/><styles><align>justify</align></styles></para><para><coId>6522-1635252126985</coId><text>增加-r参数，-r   Don't exit on socket receive errors.</text><inline-styles><font-family><from>0</from><to>2</to><value>微软雅黑</value></font-family><font-family><from>2</from><to>4</to><value>宋体</value></font-family><font-family><from>4</from><to>7</to><value>微软雅黑</value></font-family><font-family><from>7</from><to>9</to><value>Tahoma</value></font-family><font-family><from>12</from><to>48</to><value>Tahoma</value></font-family><color><from>7</from><to>9</to><value>#ff0000</value></color></inline-styles><styles/></para><para><coId>2067-1635252126985</coId><text>ab -n 2000 -c 100 -r -p postfile -T 'application/x-www-form-urlencoded' http://192.168.140.1:8080/seckill/doseckill</text><inline-styles><bold><from>0</from><to>115</to><value>true</value></bold><underline><from>72</from><to>115</to><value>true</value></underline><font-family><from>0</from><to>87</to><value>宋体</value></font-family><font-family><from>87</from><to>90</to><value>SimSun</value></font-family><font-family><from>90</from><to>115</to><value>宋体</value></font-family><font-size><from>0</from><to>72</to><value>12</value></font-size><color><from>72</from><to>115</to><value>#0000ff</value></color><href><from>72</from><to>115</to><value>http://192.168.140.1:8080/seckill/doseckill</value></href></inline-styles><styles/></para><para><coId>3015-1635252126985</coId><text>已经秒光，可是还有库存</text><inline-styles><bold><from>0</from><to>11</to><value>true</value></bold><font-family><from>0</from><to>11</to><value>宋体</value></font-family><font-size><from>0</from><to>11</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>8584-1635252126985</coId><text>ab -n 2000 -c 100 -p postfile -T 'application/x-www-form-urlencoded' http://192.168.137.1:8080/seckill/doseckill</text><inline-styles><underline><from>69</from><to>112</to><value>true</value></underline><font-family><from>0</from><to>112</to><value>Tahoma</value></font-family><color><from>69</from><to>112</to><value>#0000ff</value></color><href><from>69</from><to>112</to><value>http://192.168.137.1:8080/seckill/doseckill</value></href></inline-styles><styles/></para><para><coId>5055-1635252126985</coId><text>已经秒光，可是还有库存。原因，就是乐观锁导致很多请求都失败。先点的没秒到，后点的可能秒到了。</text><inline-styles><font-family><from>0</from><to>46</to><value>微软雅黑</value></font-family><color><from>17</from><to>29</to><value>#ff0000</value></color></inline-styles><styles/></para><image><coId>4310-1635252126985</coId><source>https://note.youdao.com/yws/res/14218/451CD707E19A480E93D3F930FA0A126B</source><text/><styles><width>266</width><height>95</height></styles></image><para><coId>6123-1635252126985</coId><text> </text><inline-styles><font-family><from>0</from><to>1</to><value>SimSun</value></font-family></inline-styles><styles/></para><para><coId>4614-1635252126985</coId><text>连接超时，通过连接池解决</text><inline-styles><bold><from>0</from><to>12</to><value>true</value></bold><font-family><from>0</from><to>12</to><value>宋体</value></font-family><font-size><from>0</from><to>12</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><image><coId>9010-1635506476372</coId><source>https://note.youdao.com/yws/res/14223/A3550334C4E949649BD92F4B7DEE10F3</source><text/><styles><width>620</width><height>305</height></styles></image><image><coId>4063-1635506494136</coId><source>https://note.youdao.com/yws/res/14226/E79A2739A4DC4588934180ECA61F640A</source><text/><styles><width>620</width><height>172</height></styles></image><image><coId>1730-1635506521786</coId><source>https://note.youdao.com/yws/res/14228/49C2C080F9F942D1A42907696A8E2D00</source><text/><styles><width>620</width><height>210</height></styles></image><para><coId>7647-1635506520455</coId><text/><inline-styles/><styles/></para><para><coId>8994-1635506491761</coId><text/><inline-styles/><styles><align>justify</align></styles></para><image><coId>6284-1635252126985</coId><source>https://note.youdao.com/yws/res/14217/67062DE88EE74D4F976B650666480DD8</source><text/><styles><align>justify</align><width>556</width><height>78</height></styles></image><para><coId>4026-1635252126985</coId><text> l 链接池参数</text><inline-styles><font-family><from>3</from><to>8</to><value>宋体</value></font-family></inline-styles><styles><align>justify</align></styles></para><para><coId>7951-1635505070808</coId><text>n MaxTotal：控制一个pool可分配多少个jedis实例，通过pool.getResource()来获取；如果赋值为-1，则表示不限制；如果pool已经分配了MaxTotal个jedis实例，则此时pool的状态为exhausted。</text><inline-styles><font-family><from>2</from><to>10</to><value>Tahoma</value></font-family><font-family><from>10</from><to>15</to><value>微软雅黑</value></font-family><font-family><from>15</from><to>19</to><value>Times New Roman</value></font-family><font-family><from>19</from><to>25</to><value>微软雅黑</value></font-family><font-family><from>25</from><to>30</to><value>Times New Roman</value></font-family><font-family><from>30</from><to>35</to><value>微软雅黑</value></font-family><font-family><from>35</from><to>53</to><value>Times New Roman</value></font-family><font-family><from>53</from><to>62</to><value>微软雅黑</value></font-family><font-family><from>62</from><to>64</to><value>Times New Roman</value></font-family><font-family><from>64</from><to>74</to><value>微软雅黑</value></font-family><font-family><from>74</from><to>78</to><value>Times New Roman</value></font-family><font-family><from>78</from><to>83</to><value>微软雅黑</value></font-family><font-family><from>83</from><to>91</to><value>Times New Roman</value></font-family><font-family><from>91</from><to>92</to><value>微软雅黑</value></font-family><font-family><from>92</from><to>97</to><value>Times New Roman</value></font-family><font-family><from>97</from><to>103</to><value>微软雅黑</value></font-family><font-family><from>103</from><to>107</to><value>Times New Roman</value></font-family><font-family><from>107</from><to>111</to><value>微软雅黑</value></font-family><font-family><from>111</from><to>120</to><value>Times New Roman</value></font-family><font-family><from>120</from><to>121</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>3517-1635505070808</coId><text>n maxIdle：控制一个pool最多有多少个状态为idle(空闲)的jedis实例；</text><inline-styles><font-family><from>2</from><to>9</to><value>Tahoma</value></font-family><font-family><from>9</from><to>14</to><value>微软雅黑</value></font-family><font-family><from>14</from><to>18</to><value>Times New Roman</value></font-family><font-family><from>18</from><to>27</to><value>微软雅黑</value></font-family><font-family><from>27</from><to>32</to><value>Times New Roman</value></font-family><font-family><from>32</from><to>34</to><value>微软雅黑</value></font-family><font-family><from>34</from><to>35</to><value>Times New Roman</value></font-family><font-family><from>35</from><to>36</to><value>微软雅黑</value></font-family><font-family><from>36</from><to>41</to><value>Times New Roman</value></font-family><font-family><from>41</from><to>44</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>8969-1635505070808</coId><text>n MaxWaitMillis：表示当borrow一个jedis实例时，最大的等待毫秒数，如果超过等待时间，则直接抛JedisConnectionException；</text><inline-styles><font-family><from>2</from><to>15</to><value>Tahoma</value></font-family><font-family><from>15</from><to>19</to><value>微软雅黑</value></font-family><font-family><from>19</from><to>25</to><value>Times New Roman</value></font-family><font-family><from>25</from><to>27</to><value>微软雅黑</value></font-family><font-family><from>27</from><to>32</to><value>Times New Roman</value></font-family><font-family><from>32</from><to>58</to><value>微软雅黑</value></font-family><font-family><from>58</from><to>82</to><value>Times New Roman</value></font-family><font-family><from>82</from><to>83</to><value>微软雅黑</value></font-family><font-size><from>15</from><to>56</to><value>13</value></font-size></inline-styles><styles/></para><para><coId>7060-1635505070808</coId><text>n testOnBorrow：获得一个jedis实例的时候是否检查连接可用性（ping()）；如果为true，则得到的jedis实例均是可用的；</text><inline-styles><font-family><from>2</from><to>14</to><value>Tahoma</value></font-family><font-family><from>14</from><to>19</to><value>微软雅黑</value></font-family><font-family><from>19</from><to>24</to><value>Times New Roman</value></font-family><font-family><from>24</from><to>39</to><value>微软雅黑</value></font-family><font-family><from>39</from><to>45</to><value>Times New Roman</value></font-family><font-family><from>45</from><to>50</to><value>微软雅黑</value></font-family><font-family><from>50</from><to>54</to><value>Times New Roman</value></font-family><font-family><from>54</from><to>59</to><value>微软雅黑</value></font-family><font-family><from>59</from><to>64</to><value>Times New Roman</value></font-family><font-family><from>64</from><to>72</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><table><coId>4067-1635506726892</coId><resource-list/><content>{"cells":[{"value":"//增加乐观锁\njedis.watch(qtkey);\n \n//3.判断库存\nString qtkeystr = jedis.get(qtkey);\nif(qtkeystr==null || \"\".equals(qtkeystr.trim())) {\nSystem.out.println(\"未初始化库存\");\njedis.close();\nreturn false ;\n}\n \nint qt = Integer.parseInt(qtkeystr);\nif(qt&lt;=0) {\nSystem.err.println(\"已经秒光\");\njedis.close();\nreturn false;\n}\n \n//增加事务\nTransaction multi = jedis.multi();\n \n//4.减少库存\n//jedis.decr(qtkey);\nmulti.decr(qtkey);\n \n//5.加人\n//jedis.sadd(usrkey, uid);\nmulti.sadd(usrkey, uid);\n \n//执行事务\nList&lt;Object&gt; list = multi.exec();\n \n//判断事务提交是否失败\nif(list==null || list.size()==0) {\nSystem.out.println(\"秒杀失败\");\njedis.close();\nreturn false;\n}\nSystem.err.println(\"秒杀成功\");\njedis.close();","inlineStyles":{"bold":[{"from":319,"to":324,"value":true},{"from":374,"to":379,"value":true},{"from":429,"to":434,"value":true},{"from":483,"to":488,"value":true},{"from":622,"to":629,"value":true}],"font-family":[{"from":0,"to":2,"value":"Tahoma"},{"from":8,"to":27,"value":"Tahoma"},{"from":28,"to":29,"value":"Tahoma"},{"from":30,"to":34,"value":"Tahoma"},{"from":39,"to":74,"value":"Tahoma"},{"from":75,"to":125,"value":"Tahoma"},{"from":126,"to":146,"value":"Tahoma"},{"from":152,"to":155,"value":"Times New Roman"},{"from":156,"to":170,"value":"Tahoma"},{"from":171,"to":185,"value":"Tahoma"},{"from":186,"to":187,"value":"Tahoma"},{"from":188,"to":189,"value":"Tahoma"},{"from":190,"to":226,"value":"Tahoma"},{"from":227,"to":238,"value":"Tahoma"},{"from":239,"to":259,"value":"Tahoma"},{"from":263,"to":266,"value":"Times New Roman"},{"from":267,"to":281,"value":"Tahoma"},{"from":282,"to":295,"value":"Tahoma"},{"from":296,"to":297,"value":"Tahoma"},{"from":298,"to":299,"value":"Tahoma"},{"from":300,"to":302,"value":"Tahoma"},{"from":307,"to":324,"value":"Tahoma"},{"from":325,"to":341,"value":"Tahoma"},{"from":342,"to":343,"value":"Tahoma"},{"from":344,"to":348,"value":"Tahoma"},{"from":353,"to":373,"value":"Tahoma"},{"from":374,"to":392,"value":"Tahoma"},{"from":393,"to":394,"value":"Tahoma"},{"from":395,"to":399,"value":"Tahoma"},{"from":402,"to":428,"value":"Tahoma"},{"from":429,"to":453,"value":"Tahoma"},{"from":454,"to":455,"value":"Tahoma"},{"from":456,"to":458,"value":"Tahoma"},{"from":463,"to":496,"value":"Tahoma"},{"from":497,"to":498,"value":"Tahoma"},{"from":499,"to":501,"value":"Tahoma"},{"from":512,"to":546,"value":"Tahoma"},{"from":547,"to":567,"value":"Tahoma"},{"from":571,"to":574,"value":"Times New Roman"},{"from":575,"to":589,"value":"Tahoma"},{"from":590,"to":603,"value":"Tahoma"},{"from":604,"to":605,"value":"Tahoma"},{"from":606,"to":626,"value":"Tahoma"},{"from":630,"to":633,"value":"Times New Roman"},{"from":634,"to":648,"value":"Tahoma"}]}}],"heights":[40],"widths":[620]}</content><styles/></table><heading compat="true" level="2"><coId>9463-1635506700898</coId><text>并发任务中加入乐观锁会产生库存遗留问题</text><inline-styles><bold><from>0</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>19</to><value>微软雅黑</value></font-family><font-size><from>0</from><to>19</to><value>20</value></font-size></inline-styles><styles/></heading><para><coId>7021-1635508597049</coId><text>Lua 是一个小巧的脚本语言，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。</text><inline-styles><underline><from>10</from><to>14</to><value>true</value></underline><font-family><from>0</from><to>4</to><value>Tahoma</value></font-family><font-family><from>4</from><to>15</to><value>微软雅黑</value></font-family><font-family><from>15</from><to>18</to><value>Tahoma</value></font-family><font-family><from>18</from><to>27</to><value>微软雅黑</value></font-family><font-family><from>27</from><to>33</to><value>Times New Roman</value></font-family><font-family><from>33</from><to>46</to><value>微软雅黑</value></font-family><font-family><from>46</from><to>51</to><value>Times New Roman</value></font-family><font-family><from>51</from><to>55</to><value>微软雅黑</value></font-family><font-family><from>55</from><to>58</to><value>Times New Roman</value></font-family><font-family><from>58</from><to>73</to><value>微软雅黑</value></font-family><font-family><from>73</from><to>76</to><value>Times New Roman</value></font-family><font-family><from>76</from><to>81</to><value>微软雅黑</value></font-family><font-family><from>81</from><to>85</to><value>Times New Roman</value></font-family><font-family><from>85</from><to>88</to><value>微软雅黑</value></font-family><font-family><from>88</from><to>91</to><value>Times New Roman</value></font-family><font-family><from>91</from><to>120</to><value>微软雅黑</value></font-family><color><from>10</from><to>14</to><value>#0000ff</value></color><color><from>112</from><to>119</to><value>#ff0000</value></color><href><from>10</from><to>14</to><value>http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80</value></href></inline-styles><styles/></para><para><coId>4190-1635508597276</coId><text>很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。</text><inline-styles><font-family><from>0</from><to>11</to><value>微软雅黑</value></font-family><font-family><from>11</from><to>14</to><value>Tahoma</value></font-family><font-family><from>14</from><to>42</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>4071-1635508597276</coId><text>这其中包括魔兽争霸地图、魔兽世界、博德之门、愤怒的小鸟等众多游戏插件或外挂。</text><inline-styles><font-family><from>0</from><to>38</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>1869-1635508597276</coId><text>https://www.w3cschool.cn/lua/</text><inline-styles><underline><from>0</from><to>29</to><value>true</value></underline><font-family><from>0</from><to>29</to><value>Times New Roman</value></font-family><color><from>0</from><to>29</to><value>#0000ff</value></color><href><from>0</from><to>29</to><value>https://www.w3cschool.cn/lua/</value></href></inline-styles><styles/></para><para><coId>2756-1635508597276</coId><text>LUA脚本在Redis中的优势</text><inline-styles><bold><from>0</from><to>15</to><value>true</value></bold><font-family><from>0</from><to>6</to><value>宋体</value></font-family><font-family><from>6</from><to>11</to><value>Times New Roman</value></font-family><font-family><from>11</from><to>15</to><value>宋体</value></font-family><font-size><from>0</from><to>15</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>6633-1635508597276</coId><text>将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。</text><inline-styles><font-family><from>0</from><to>9</to><value>微软雅黑</value></font-family><font-family><from>9</from><to>14</to><value>Tahoma</value></font-family><font-family><from>14</from><to>29</to><value>微软雅黑</value></font-family><font-family><from>29</from><to>34</to><value>Times New Roman</value></font-family><font-family><from>34</from><to>43</to><value>微软雅黑</value></font-family><font-family><from>43</from><to>48</to><value>Times New Roman</value></font-family><font-family><from>48</from><to>57</to><value>微软雅黑</value></font-family></inline-styles><styles/></para><para><coId>5889-1635508597276</coId><text>LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。</text><inline-styles><font-family><from>0</from><to>3</to><value>Tahoma</value></font-family><font-family><from>3</from><to>8</to><value>微软雅黑</value></font-family><font-family><from>8</from><to>13</to><value>Times New Roman</value></font-family><font-family><from>13</from><to>40</to><value>微软雅黑</value></font-family><font-family><from>40</from><to>45</to><value>Tahoma</value></font-family><font-family><from>45</from><to>52</to><value>微软雅黑</value></font-family><color><from>0</from><to>16</to><value>#007c6a</value></color><color><from>23</from><to>52</to><value>#007c6a</value></color></inline-styles><styles/></para><para><coId>8862-1635508597276</coId><text>但是注意redis的lua脚本功能，只有在Redis 2.6以上的版本才可以使用。</text><inline-styles><font-family><from>0</from><to>4</to><value>微软雅黑</value></font-family><font-family><from>4</from><to>9</to><value>Tahoma</value></font-family><font-family><from>9</from><to>10</to><value>微软雅黑</value></font-family><font-family><from>10</from><to>13</to><value>Times New Roman</value></font-family><font-family><from>13</from><to>21</to><value>微软雅黑</value></font-family><font-family><from>21</from><to>30</to><value>Times New Roman</value></font-family><font-family><from>30</from><to>41</to><value>微软雅黑</value></font-family><color><from>0</from><to>41</to><value>#007c6a</value></color></inline-styles><styles/></para><para><coId>2023-1635508597276</coId><text>利用lua脚本淘汰用户，解决超卖问题。</text><inline-styles><font-family><from>0</from><to>2</to><value>微软雅黑</value></font-family><font-family><from>2</from><to>5</to><value>Tahoma</value></font-family><font-family><from>5</from><to>19</to><value>微软雅黑</value></font-family><color><from>0</from><to>19</to><value>#007c6a</value></color></inline-styles><styles/></para><para><coId>3558-1635508597276</coId><text>redis 2.6版本以后，通过lua脚本解决争抢问题，实际上是redis 利用其单线程的特性，用任务队列的方式解决多任务并发问题。</text><inline-styles><bold><from>23</from><to>27</to><value>true</value></bold><bold><from>32</from><to>65</to><value>true</value></bold><font-family><from>0</from><to>9</to><value>Tahoma</value></font-family><font-family><from>9</from><to>16</to><value>微软雅黑</value></font-family><font-family><from>16</from><to>19</to><value>Times New Roman</value></font-family><font-family><from>19</from><to>32</to><value>微软雅黑</value></font-family><font-family><from>32</from><to>38</to><value>Tahoma</value></font-family><font-family><from>38</from><to>66</to><value>微软雅黑</value></font-family><color><from>23</from><to>27</to><value>#ff0000</value></color><color><from>32</from><to>65</to><value>#ff0000</value></color><color><from>65</from><to>66</to><value>#007c6a</value></color></inline-styles><styles/></para><table><coId>7625-1635508859625</coId><resource-list/><content>{"cells":[{"value":"local userid=KEYS[1]; \nlocal prodid=KEYS[2];\nlocal qtkey=\"sk:\"..prodid..\":qt\";\nlocal usersKey=\"sk:\"..prodid.\":usr'; \nlocal userExists=redis.call(\"sismember\",usersKey,userid);\nif tonumber(userExists)==1 then \n  return 2;\nend\nlocal num= redis.call(\"get\" ,qtkey);\nif tonumber(num)&lt;=0 then \n  return 0; \nelse \n  redis.call(\"decr\",qtkey);\n  redis.call(\"sadd\",usersKey,userid);\nend\nreturn 1;","inlineStyles":{"font-family":[{"from":0,"to":22,"value":"Tahoma"},{"from":23,"to":44,"value":"Tahoma"},{"from":45,"to":78,"value":"Tahoma"},{"from":79,"to":116,"value":"Tahoma"},{"from":117,"to":174,"value":"Tahoma"},{"from":175,"to":207,"value":"Tahoma"},{"from":210,"to":219,"value":"Tahoma"},{"from":220,"to":223,"value":"Tahoma"},{"from":224,"to":260,"value":"Tahoma"},{"from":261,"to":286,"value":"Tahoma"},{"from":289,"to":299,"value":"Tahoma"},{"from":300,"to":305,"value":"Tahoma"},{"from":308,"to":333,"value":"Tahoma"},{"from":336,"to":371,"value":"Tahoma"},{"from":372,"to":375,"value":"Tahoma"},{"from":376,"to":385,"value":"Tahoma"}]}}],"heights":[40],"widths":[620]}</content><styles/></table><para><coId>1445-1635508859625</coId><text/><inline-styles/><styles/></para></body></note>