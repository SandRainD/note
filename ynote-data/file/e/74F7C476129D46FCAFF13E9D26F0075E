<?xml version="1.0" encoding="UTF-8" standalone="no"?><note xmlns="http://note.youdao.com" file-version="0" schema-version="1.0.3"><head/><body><para><coId>5121-1635941216389</coId><text>1.1.   ACL</text><inline-styles><bold><from>0</from><to>4</to><value>true</value></bold><bold><from>7</from><to>10</to><value>true</value></bold><font-family><from>0</from><to>7</to><value>Times New Roman</value></font-family><font-family><from>7</from><to>10</to><value>Arial</value></font-family><font-size><from>0</from><to>4</to><value>21</value></font-size><font-size><from>4</from><to>7</to><value>9</value></font-size><font-size><from>7</from><to>10</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>1416-1635941250963</coId><text>1.1.1.           简介</text><inline-styles><bold><from>0</from><to>6</to><value>true</value></bold><bold><from>17</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>17</to><value>Times New Roman</value></font-family><font-family><from>17</from><to>19</to><value>SimSun</value></font-family><font-size><from>0</from><to>6</to><value>21</value></font-size><font-size><from>6</from><to>17</to><value>9</value></font-size><font-size><from>17</from><to>19</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>4586-1635941250963</coId><text>Redis ACL是Access Control List（访问控制列表）的缩写，该功能允许根据可以执行的命令和可以访问的键来限制某些连接。</text><inline-styles/><styles><align>justify</align><text-indent>1</text-indent></styles></para><para><coId>5664-1635941250963</coId><text>在Redis 5版本之前，Redis 安全规则只有密码控制 还有通过rename 来调整高危命令比如 flushdb ， KEYS* ， shutdown 等。Redis 6 则提供ACL的功能对用户进行更细粒度的权限控制 ：</text><inline-styles/><styles><align>justify</align><text-indent>1</text-indent></styles></para><para><coId>6574-1635941250963</coId><text>（1）接入权限:用户名和密码</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>5680-1635941250963</coId><text>（2）可以执行的命令</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>3570-1635941250963</coId><text>（3）可以操作的 KEY</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>1971-1635941250963</coId><text>参考官网：https://redis.io/topics/acl</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>2174-1635941250963</coId><text> </text><inline-styles/><styles><align>justify</align></styles></para><para><coId>3436-1635941250963</coId><text>1.1.2.           命令</text><inline-styles><bold><from>0</from><to>6</to><value>true</value></bold><bold><from>17</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>17</to><value>Times New Roman</value></font-family><font-family><from>17</from><to>19</to><value>SimSun</value></font-family><font-size><from>0</from><to>6</to><value>21</value></font-size><font-size><from>6</from><to>17</to><value>9</value></font-size><font-size><from>17</from><to>19</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>5011-1635941250963</coId><text>1、使用acl list命令展现用户权限列表</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>8054-1635941250963</coId><text>（1）数据说明</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>1063-1635941273003</coId><source>https://note.youdao.com/yws/res/14506/F686EFD909A44ADEA318FA04E168FE38</source><text/><styles><width>554</width><height>179</height></styles></image><para><coId>1969-1635941250963</coId><text>2、使用acl cat命令</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>7430-1635941250963</coId><text>（1）查看添加权限指令类别</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>2027-1635941279556</coId><source>https://note.youdao.com/yws/res/14509/06B332F4B8694AB09C0C92EAAD0D8808</source><text/><styles><width>201</width><height>353</height></styles></image><para><coId>4712-1635941250963</coId><text>（2）加参数类型名可以查看类型下具体命令</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>6068-1635941286199</coId><source>https://note.youdao.com/yws/res/14512/08608F981A57459DBF8B2856BF7FD089</source><text/><styles><width>257</width><height>336</height></styles></image><para><coId>3139-1635941250963</coId><text>3、使用acl whoami命令查看当前用户</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>4350-1635941294719</coId><source>https://note.youdao.com/yws/res/14514/FAFF07C1ABB3463687491A3A11E46185</source><text/><styles><width>212</width><height>34</height></styles></image><para><coId>1059-1635941250963</coId><text>4、使用aclsetuser命令创建和编辑用户ACL</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>5760-1635941250963</coId><text>（1）ACL规则</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>7219-1635941250963</coId><text>下面是有效ACL规则的列表。某些规则只是用于激活或删除标志，或对用户ACL执行给定更改的单个单词。其他规则是字符前缀，它们与命令或类别名称、键模式等连接在一起。</text><inline-styles><font-size><from>70</from><to>74</to><value>13</value></font-size></inline-styles><styles><align>justify</align><text-indent>1</text-indent></styles></para><table><coId>7157-1635941250963</coId><resource-list/><content>{"cells":[{"mergeHeight":1,"mergeWidth":3,"textAlign":"left","verticalAlign":"middle","value":"ACL规则","inlineStyles":{"font-size":[{"from":0,"to":5,"value":21}]}},{"mergePointDX":1,"mergePointDY":0,"value":""},{"mergePointDX":2,"mergePointDY":0,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"类型"},{"textAlign":"left","verticalAlign":"middle","value":"参数"},{"textAlign":"left","verticalAlign":"middle","value":"说明"},{"mergeHeight":2,"mergeWidth":1,"textAlign":"left","verticalAlign":"middle","value":"启动和禁用用户"},{"textAlign":"left","verticalAlign":"middle","value":"on","inlineStyles":{"bold":[{"from":0,"to":2,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"激活某用户账号"},{"mergePointDX":0,"mergePointDY":1,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"off","inlineStyles":{"bold":[{"from":0,"to":3,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"禁用某用户账号。注意，已验证的连接仍然可以工作。如果默认用户被标记为off，则新连接将在未进行身份验证的情况下启动，并要求用户使用AUTH选项发送AUTH或HELLO，以便以某种方式进行身份验证。"},{"mergeHeight":6,"mergeWidth":1,"textAlign":"left","verticalAlign":"middle","value":"权限的添加删除"},{"textAlign":"left","verticalAlign":"middle","value":"+&lt;command&gt;","inlineStyles":{"bold":[{"from":0,"to":10,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"将指令添加到用户可以调用的指令列表中"},{"mergePointDX":0,"mergePointDY":1,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"-&lt;command&gt;","inlineStyles":{"bold":[{"from":0,"to":10,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"从用户可执行指令列表移除指令"},{"mergePointDX":0,"mergePointDY":2,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"+@&lt;category&gt;","inlineStyles":{"bold":[{"from":0,"to":12,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"添加该类别中用户要调用的所有指令，有效类别为@admin、@set、@sortedset…等，通过调用ACL CAT命令查看完整列表。特殊类别@all表示所有命令，包括当前存在于服务器中的命令，以及将来将通过模块加载的命令。","inlineStyles":{"color":[{"from":22,"to":44,"value":"#ff0000"},{"from":51,"to":58,"value":"#ff0000"}]}},{"mergePointDX":0,"mergePointDY":3,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"-@&lt;actegory&gt;"},{"textAlign":"left","verticalAlign":"middle","value":"从用户可调用指令中移除类别"},{"mergePointDX":0,"mergePointDY":4,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"allcommands","inlineStyles":{"bold":[{"from":0,"to":11,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"+@all的别名"},{"mergePointDX":0,"mergePointDY":5,"value":""},{"textAlign":"left","verticalAlign":"middle","value":"nocommand","inlineStyles":{"bold":[{"from":0,"to":9,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"-@all的别名"},{"textAlign":"left","verticalAlign":"middle","value":"可操作键的添加或删除"},{"textAlign":"left","verticalAlign":"middle","value":"~&lt;pattern&gt;","inlineStyles":{"bold":[{"from":0,"to":10,"value":true}]}},{"textAlign":"left","verticalAlign":"middle","value":"添加可作为用户可操作的键的模式。例如~*允许所有的键"}],"heights":[23.65,11.8,11.8,47.4,11.8,11.8,47.4,12.4,11.8,11.8,23.65],"widths":[147,147,263]}</content><styles/></table><para><coId>4938-1635941250963</coId><text> </text><inline-styles/><styles><align>justify</align><text-indent>1</text-indent></styles></para><para><coId>9100-1635941250963</coId><text>（2）通过命令创建新用户默认权限</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>5721-1635941250963</coId><text>acl setuser user1</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>5034-1635941309186</coId><source>https://note.youdao.com/yws/res/14516/3F4E83B6432E400C89A80FB0712BB220</source><text/><styles><width>295</width><height>82</height></styles></image><para><coId>8327-1635941250963</coId><text>在上面的示例中，我根本没有指定任何规则。如果用户不存在，这将使用just created的默认属性来创建用户。如果用户已经存在，则上面的命令将不执行任何操作。</text><inline-styles><color><from>0</from><to>79</to><value>#333333</value></color><back-color><from>0</from><to>79</to><value>#ffffff</value></back-color></inline-styles><styles><align>justify</align></styles></para><para><coId>1915-1635941250963</coId><text> </text><inline-styles><color><from>0</from><to>1</to><value>#333333</value></color><back-color><from>0</from><to>1</to><value>#ffffff</value></back-color></inline-styles><styles><align>justify</align></styles></para><para><coId>5034-1635941250963</coId><text>（3）设置有用户名、密码、ACL权限、并启用的用户</text><inline-styles><color><from>0</from><to>25</to><value>#333333</value></color><back-color><from>0</from><to>25</to><value>#ffffff</value></back-color></inline-styles><styles><align>justify</align></styles></para><para><coId>3027-1635941250963</coId><text>acl setuser user2 on &gt;password ~cached:* +get</text><inline-styles><font-size><from>0</from><to>45</to><value>16</value></font-size></inline-styles><styles><align>justify</align></styles></para><image><coId>1391-1635941320080</coId><source>https://note.youdao.com/yws/res/14520/818D0A4F7EA34D32ADECAD6150E6A603</source><text/><styles><width>554</width><height>105</height></styles></image><para><coId>7110-1635941250963</coId><text>(4)切换用户，验证权限</text><inline-styles/><styles><align>justify</align></styles></para><image><coId>2154-1635941326849</coId><source>https://note.youdao.com/yws/res/14522/1E476EF984354B9F87FDF1D2FC56A8ED</source><text/><styles><width>554</width><height>199</height></styles></image><para><coId>4297-1635941326849</coId><text/><inline-styles/><styles><align>justify</align></styles></para><para><coId>3310-1635941341379</coId><text/><inline-styles/><styles><align>justify</align></styles></para><para><coId>5372-1635941341504</coId><text/><inline-styles/><styles><align>justify</align></styles></para><para><coId>2962-1635941341637</coId><text>1.1.   IO多线程</text><inline-styles><bold><from>0</from><to>4</to><value>true</value></bold><bold><from>7</from><to>12</to><value>true</value></bold><font-family><from>0</from><to>7</to><value>Times New Roman</value></font-family><font-family><from>7</from><to>9</to><value>Arial</value></font-family><font-family><from>9</from><to>12</to><value>SimHei</value></font-family><font-size><from>0</from><to>4</to><value>21</value></font-size><font-size><from>4</from><to>7</to><value>9</value></font-size><font-size><from>7</from><to>12</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>1819-1635941341981</coId><text>1.1.1.           简介</text><inline-styles><bold><from>0</from><to>6</to><value>true</value></bold><bold><from>17</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>17</to><value>Times New Roman</value></font-family><font-family><from>17</from><to>19</to><value>SimSun</value></font-family><font-size><from>0</from><to>6</to><value>21</value></font-size><font-size><from>6</from><to>17</to><value>9</value></font-size><font-size><from>17</from><to>19</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>9247-1635941341981</coId><text>Redis6终于支撑多线程了，告别单线程了吗？</text><inline-styles><font-family><from>0</from><to>23</to><value>SimSun</value></font-family></inline-styles><styles><align>justify</align><text-indent>1</text-indent></styles></para><para><coId>5167-1635941341981</coId><text>IO多线程其实指客户端交互部分的网络IO交互处理模块多线程，而非执行命令多线程。Redis6执行命令依然是单线程。</text><inline-styles><bold><from>8</from><to>15</to><value>true</value></bold><bold><from>16</from><to>20</to><value>true</value></bold><bold><from>26</from><to>29</to><value>true</value></bold><bold><from>32</from><to>39</to><value>true</value></bold><font-family><from>0</from><to>57</to><value>SimSun</value></font-family></inline-styles><styles><align>justify</align><text-indent>1</text-indent></styles></para><para><coId>2724-1635941341981</coId><text> </text><inline-styles><font-family><from>0</from><to>1</to><value>SimSun</value></font-family></inline-styles><styles><align>justify</align></styles></para><para><coId>3731-1635941341981</coId><text>1.1.2.           原理架构</text><inline-styles><bold><from>0</from><to>6</to><value>true</value></bold><bold><from>17</from><to>21</to><value>true</value></bold><font-family><from>0</from><to>17</to><value>Times New Roman</value></font-family><font-family><from>17</from><to>21</to><value>SimSun</value></font-family><font-size><from>0</from><to>6</to><value>21</value></font-size><font-size><from>6</from><to>17</to><value>9</value></font-size><font-size><from>17</from><to>21</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>4045-1635941341981</coId><text>Redis 6 加入多线程,但跟 Memcached 这种从 IO处理到数据访问多线程的实现模式有些差异。Redis 的多线程部分只是用来处理网络数据的读写和协议解析，执行命令仍然是单线程。之所以这么设计是不想因为多线程而变得复杂，需要去控制 key、lua、事务，LPUSH/LPOP 等等的并发问题。整体的设计大体如下:</text><inline-styles><font-family><from>0</from><to>162</to><value>SimSun</value></font-family></inline-styles><styles><align>justify</align></styles></para><image><coId>4851-1635941347764</coId><source>https://note.youdao.com/yws/res/14525/1DEA90C7215544F5842B833824ABC978</source><text/><styles><width>554</width><height>347</height></styles></image><para><coId>5457-1635941347764</coId><text>另外，多线程IO默认也是不开启的，需要再配置文件中配置</text><inline-styles/><styles><align>justify</align></styles></para><para><coId>6641-1635941352038</coId><text>io-threads-do-reads  yes</text><inline-styles/><styles/></para><para><coId>2295-1635941352038</coId><text>io-threads 4</text><inline-styles/><styles/></para><para><coId>4151-1635941353341</coId><text>1.1.   工具支持 Cluster</text><inline-styles><bold><from>0</from><to>4</to><value>true</value></bold><bold><from>7</from><to>19</to><value>true</value></bold><font-family><from>0</from><to>7</to><value>Times New Roman</value></font-family><font-family><from>7</from><to>11</to><value>SimHei</value></font-family><font-family><from>11</from><to>19</to><value>Arial</value></font-family><font-size><from>0</from><to>4</to><value>21</value></font-size><font-size><from>4</from><to>7</to><value>9</value></font-size><font-size><from>7</from><to>19</to><value>21</value></font-size></inline-styles><styles><align>justify</align></styles></para><para><coId>2249-1635941365697</coId><text>之前老版Redis想要搭集群需要单独安装ruby环境，Redis 5 将 redis-trib.rb 的功能集成到 redis-cli 。另外官方 redis-benchmark 工具开始支持 cluster 模式了，通过多线程的方式对多个分片进行压测。</text><inline-styles/><styles/></para><image><coId>6289-1635941373403</coId><source>https://note.youdao.com/yws/res/14530/F7193EF5A0F64AA190A9F68B50AC9125</source><text/><styles><width>554</width><height>239</height></styles></image><para><coId>0029-1635941353603</coId><text>Redis6新功能还有：</text><inline-styles/><styles><text-indent>1</text-indent></styles></para><para><coId>5599-1635941384581</coId><text>1、RESP3新的 Redis 通信协议：优化服务端与客户端之间通信</text><inline-styles/><styles><text-indent>1</text-indent></styles></para><para><coId>7813-1635941384581</coId><text>2、Client side caching客户端缓存：基于 RESP3 协议实现的客户端缓存功能。为了进一步提升缓存的性能，将客户端经常访问的数据cache到客户端。减少TCP网络交互。</text><inline-styles/><styles><text-indent>1</text-indent></styles></para><para><coId>9920-1635941384581</coId><text>3、Proxy集群代理模式：Proxy 功能，让 Cluster 拥有像单实例一样的接入方式，降低大家使用cluster的门槛。不过需要注意的是代理不改变 Cluster 的功能限制，不支持的命令还是不会支持，比如跨 slot 的多Key操作。</text><inline-styles/><styles><text-indent>1</text-indent></styles></para><para><coId>5154-1635941384581</coId><text>4、Modules API</text><inline-styles/><styles><text-indent>1</text-indent></styles></para><para><coId>1621-1635941384581</coId><text>Redis 6中模块API开发进展非常大，因为Redis Labs为了开发复杂的功能，从一开始就用上Redis模块。Redis可以变成一个框架，利用Modules来构建不同系统，而不需要从头开始写然后还要BSD许可。Redis一开始就是一个向编写各种系统开放的平台。</text><inline-styles/><styles><text-indent>1</text-indent></styles></para></body></note>